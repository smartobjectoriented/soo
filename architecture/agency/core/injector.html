<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.2.1.4. ME Injector &mdash; Smart Object Oriented 2021.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/style.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/theme_overrides.css?v=7751120a" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/documentation_options.js?v=b4aaf8b5"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="2.2.2. SOOlink subsystem" href="../soolink/soolink.html" />
    <link rel="prev" title="2.2.1.3. ME access logical block" href="me_access.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Smart Object Oriented
          </a>
              <div class="version">
                2021.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../architecture.html">2. SOO Architecture</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../overall.html">2.1. Overall framework architecture</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../agency.html">2.2. Agency</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="core.html">2.2.1. Core subsystem</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="migration_manager.html">2.2.1.1. Migration manager logical block</a></li>
<li class="toctree-l4"><a class="reference internal" href="device_access.html">2.2.1.2. Device access logical block</a></li>
<li class="toctree-l4"><a class="reference internal" href="me_access.html">2.2.1.3. ME access logical block</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">2.2.1.4. ME Injector</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../soolink/soolink.html">2.2.2. SOOlink subsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../agency.html#vbus-and-vbstore">2.2.3. VBus and VBstore</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ME/ME.html">2.3. Mobile Entity (ME)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../virt_interfaces/virt_interfaces.html">2.4. Virtualized interfaces (backend/frontend)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../drivers/drivers.html">3. Frontend &amp; backend drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rootfs/rootfs.html">4. User applications and rootfs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide.html">5. User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../logging.html">6. Logging facility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../logging.html#enabling-initcall-logging">7. Enabling <code class="docutils literal notranslate"><span class="pre">initcall</span></code> logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../board_issues.html">8. Board related issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aarch64.html">9. Configuration for AArch64 64-bit architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_flow.html">10. Development  flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">11. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ME/ME.html">12. Mobile Entities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/demos.html">13. Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../coding_conventions.html">14. Coding conventions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Smart Object Oriented</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../architecture.html"><span class="section-number">2. </span>SOO Architecture</a></li>
          <li class="breadcrumb-item"><a href="../agency.html"><span class="section-number">2.2. </span>Agency</a></li>
          <li class="breadcrumb-item"><a href="core.html"><span class="section-number">2.2.1. </span>Core subsystem</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2.2.1.4. </span>ME Injector</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="me-injector">
<span id="injector"></span><h1><span class="section-number">2.2.1.4. </span>ME Injector<a class="headerlink" href="#me-injector" title="Link to this heading">¶</a></h1>
<p>The <strong>ME Injector</strong> functionality allows a ME to be injected into a smart object. At the bootstrap of SOO, the Agency looks
at a dedicated partition of the SD-CARD to retrieve some ME ITBs. It can also inject ME using Bluetooth, via the <a class="reference internal" href="../../../drivers/vuihandler.html#vuihandler"><span class="std std-ref">vuihandler</span></a>.</p>
<p>An ME is packed into a U-boot ITB file which is parsed by the AVZ hypervisor when loading into the RAM.</p>
<section id="deployment-in-dedicated-storage-partition">
<h2><span class="section-number">2.2.1.4.1. </span>Deployment in dedicated storage partition<a class="headerlink" href="#deployment-in-dedicated-storage-partition" title="Link to this heading">¶</a></h2>
<p>This is the standard method used in the Smart Objects. The entities (MEs) are stored in a dedicated
partition (<em>/mnt/ME</em> mount point) as ITB.</p>
<p>The Agency core automatically injects all MEs that are in this partition by invoking <code class="docutils literal notranslate"><span class="pre">ME_inject()</span></code> which
query the hypervisor to parse the ITB buffer.</p>
</section>
<section id="deployment-via-a-remote-gui">
<h2><span class="section-number">2.2.1.4.2. </span>Deployment via a remote GUI<a class="headerlink" href="#deployment-via-a-remote-gui" title="Link to this heading">¶</a></h2>
<p>A user can upload a ME from a tablet (or smartphone). The ME ITB is stored in the Android device and is transferred
via Bluetooth. The <code class="docutils literal notranslate"><span class="pre">vuihandler</span></code> backend is involved in the retrieval of the ITB buffer and invokes the injector
to load the ME.</p>
<figure class="align-center">
<img alt="../../../_images/SOO_architecture_injector_ME_BT.png" src="../../../_images/SOO_architecture_injector_ME_BT.png" />
</figure>
<p>The ME reception and injection via BT is described in the diagram above. The <code class="docutils literal notranslate"><span class="pre">vuiHandler</span></code> receives ME chunks asynchronously
and forward them to the <em>Injector</em> if the packet is a <cite>ME_SIZE</cite> packet or a <cite>ME_DATA</cite> packet. The size is received only once at the
beginning of the transfer. The ME data are received as chunks of max 960B (vuihandler limitation).</p>
<p>The injector allocates its buffer when it receives the size. It then appends the ME chunks as they are received.
Once the ME is fully received, it calls AVZ to effectively inject the ME. Afterward, it cleans its internal data (ME_buffer, ME_size, …).</p>
</section>
<section id="memory-management-during-the-injection">
<h2><span class="section-number">2.2.1.4.3. </span>Memory management during the injection<a class="headerlink" href="#memory-management-during-the-injection" title="Link to this heading">¶</a></h2>
<p>The injector is responsible to allocate the memory necessary to store the ITB buffer (image) which represents the ME itself.</p>
<p>When the ME is stored in the local SD-card storage, the agency core application allocates a user space area.
When the ME is retrieved from an external device using Bluetooth, the <em>Injector</em> performs an in-kernel memory
allocation in the <em>vmalloc’d</em> area of the Linux kernel.</p>
<p>These kind of memory allocation results in spare allocation of pages and implies updates of the page tables within the LInux kernel.</p>
<p>However, the hypervisor needs to switch to its own address space in order to get access to the ME memory area in the RAM.
In this MMU configuration, the ITB buffer is not accessible anymore. For this reason, a copy of the ME ITB into the AVZ heap
is done.</p>
<figure class="align-center">
<img alt="../../../_images/20220316_4_SOO_architecture-Injector.drawio.png" src="../../../_images/20220316_4_SOO_architecture-Injector.drawio.png" />
</figure>
<p>As depicted on the figure above, the ME ITB may have been loaded into the agency user space or in the <em>vmalloc’d</em> area
of the Linux kernel.</p>
<p>We assume that 8-MB AVZ heap is sufficient to host the ITB ME (&lt; 2 MB in most cases).</p>
<p>If the ITB should become larger, it is still possible to compress (and enhance AVZ with a uncompressor invoked
at loading time). Wouldn’t be still not enough, a temporary fixmap mapping combined with <em>get_free_pages</em> should be envisaged
to have the ME ITB accessible from the AVZ user space area.</p>
<p>However, in the 64-bit version, this will not be an issue anymore because the memory zone reserved to the hypervisor will be much larger.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="me_access.html" class="btn btn-neutral float-left" title="2.2.1.3. ME access logical block" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../soolink/soolink.html" class="btn btn-neutral float-right" title="2.2.2. SOOlink subsystem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, HEIG-VD - REDS Institute.
      <span class="lastupdated">Last updated on 08 Jul 2024, 16:43.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>