<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.3. Mobile Entity (ME) &mdash; Smart Object Oriented 2021.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/style.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/theme_overrides.css?v=7751120a" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/documentation_options.js?v=b4aaf8b5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.4. Virtualized interfaces (backend/frontend)" href="../virt_interfaces/virt_interfaces.html" />
    <link rel="prev" title="2.2.2.3. Plugins management" href="../agency/soolink/plugins.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Smart Object Oriented
          </a>
              <div class="version">
                2021.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../architecture.html">2. SOO Architecture</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overall.html">2.1. Overall framework architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agency/agency.html">2.2. Agency</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.3. Mobile Entity (ME)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#me-id-information">2.3.1. ME ID Information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#device-tree-properties-bindings-and-entries-in-vbstore">2.3.1.1. Device tree properties bindings and entries in vbstore</a></li>
<li class="toctree-l4"><a class="reference internal" href="#species-identifier-spid">2.3.1.2. Species Identifier (SPID)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#species-aptitude-descriptor-spad">2.3.1.3. Species Aptitude Descriptor (SPAD)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#lifecycle-of-a-mobile-entity">2.3.2. Lifecycle of a Mobile Entity</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#state-of-a-mobile-entity">2.3.2.1. State of a Mobile Entity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#callback-functions">2.3.2.2. Callback functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#callback-sequence-in-the-injected-me">2.3.2.3. Callback sequence in the injected ME</a></li>
<li class="toctree-l4"><a class="reference internal" href="#callback-sequence-in-the-residing-me">2.3.2.4. Callback sequence in the residing ME</a></li>
<li class="toctree-l4"><a class="reference internal" href="#callback-sequence-in-the-migrating-me">2.3.2.5. Callback sequence in the migrating ME</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#me-interactions-with-the-user-interface-application">2.3.3. ME Interactions with the User Interface application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#message-handling">2.3.3.1. Message handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#event-handling">2.3.3.2. Event handling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../virt_interfaces/virt_interfaces.html">2.4. Virtualized interfaces (backend/frontend)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers/drivers.html">3. Frontend &amp; backend drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rootfs/rootfs.html">4. User applications and rootfs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide.html">5. User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../logging.html">6. Logging facility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../logging.html#enabling-initcall-logging">7. Enabling <code class="docutils literal notranslate"><span class="pre">initcall</span></code> logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../board_issues.html">8. Board related issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aarch64.html">9. Configuration for AArch64 64-bit architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_flow.html">10. Development  flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">11. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ME/ME.html">12. Mobile Entities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../demos/demos.html">13. Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../coding_conventions.html">14. Coding conventions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Smart Object Oriented</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../architecture.html"><span class="section-number">2. </span>SOO Architecture</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2.3. </span>Mobile Entity (ME)</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mobile-entity-me">
<span id="me-architecture"></span><h1><span class="section-number">2.3. </span>Mobile Entity (ME)<a class="headerlink" href="#mobile-entity-me" title="Link to this heading">¶</a></h1>
<p>A Mobile Entity (ME) is the core logic of the application which can be constituted of several tasks or
even of several processes. MEs are based on SO3 operating system.</p>
<section id="me-id-information">
<h2><span class="section-number">2.3.1. </span>ME ID Information<a class="headerlink" href="#me-id-information" title="Link to this heading">¶</a></h2>
<p>All information related to the identity of the ME (SPID, name, short desc, etc.) is primarly
found in its ME device tree (DT).</p>
<section id="device-tree-properties-bindings-and-entries-in-vbstore">
<h3><span class="section-number">2.3.1.1. </span>Device tree properties bindings and entries in vbstore<a class="headerlink" href="#device-tree-properties-bindings-and-entries-in-vbstore" title="Link to this heading">¶</a></h3>
<p>The following properties are used in a ME dts.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>&lt;spid&gt;</em></p></td>
<td><p>Species ID in a 64-bit value encoding</p></td>
</tr>
<tr class="row-odd"><td><p><em>&lt;spadcaps&gt;</em></p></td>
<td><p>Species Aptitude Capabilities in a 64-bit value encoding</p></td>
</tr>
<tr class="row-even"><td><p><em>&lt;me_name&gt;</em></p></td>
<td><p>Name of this ME (for example SOO.outdoor)</p></td>
</tr>
<tr class="row-odd"><td><p><em>&lt;me_shortdesc&gt;</em></p></td>
<td><p>Short description of this ME (must contain 1024 char. max.)</p></td>
</tr>
</tbody>
</table>
<p>The following entries are dedicated to the ME ID information.</p>
<ul class="simple">
<li><p>/soo/me/&lt;domID&gt;/spid</p></li>
<li><p>/soo/me/&lt;domID&gt;/spadcaps</p></li>
<li><p>/soo/me/&lt;domID&gt;/name</p></li>
<li><p>/soo/me/&lt;domID&gt;/shortdesc</p></li>
</ul>
<p>The <a class="reference internal" href="../agency/core/migration_manager.html#migration-manager"><span class="std std-ref">Migration Manager</span></a> provides a facility to get
the list of MEs with their ID Information in the kernel and in the user space
via an ioctl.</p>
</section>
<section id="species-identifier-spid">
<h3><span class="section-number">2.3.1.2. </span>Species Identifier (SPID)<a class="headerlink" href="#species-identifier-spid" title="Link to this heading">¶</a></h3>
<p>A Mobile Entity is identified by its SPID, a unique 64-bit identifier corresponding to its species
(for example, “SOO.blind” has a unique SPID that is associated).
Several ME of the same SPIDs are de facto in various smart objects, possibly in the same smart object
until one instance decide to kill the other one(s).</p>
<p>The following SPID are currently assigned:</p>
<section id="basic-mobile-entities">
<h4><span class="section-number">2.3.1.2.1. </span>Basic mobile entities<a class="headerlink" href="#basic-mobile-entities" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SPID</p></th>
<th class="head"><p>ME Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>0x0010000000000001</em></p></td>
<td><p>SOO.refso3 used as reference ME. A new ME can be based on this model.
There are mainly two configurations (hence two dts) with and without ramfs.</p></td>
</tr>
<tr class="row-odd"><td><p><em>0x0010000000000002</em></p></td>
<td><p>SOO.ledctrl is the ME running in SOO.ledctrl smart object which is
a Raspberry Pi 4 enhanced with the Sense HAT extension. This ME
basically uses the led matrix and joystick. It is mainly used
for demonstration purposes.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="mobile-entities-devoted-to-soo-domotics-family">
<h4><span class="section-number">2.3.1.2.2. </span>Mobile entities devoted to SOO.domotics family<a class="headerlink" href="#mobile-entities-devoted-to-soo-domotics-family" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SPID</p></th>
<th class="head"><p>ME Description</p></th>
<th class="head" colspan="2"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td><p><em>0x0020000000000001</em></p></td>
<td></td>
<td><p>SOO.blind is devoted to the handling of a “standard” blind which provides
the user with features such as putting the blinds up or down, but the ME
can also perform synergies with SOO.outdoor for example to decide how
to manipulate the blinds, according to the weather condition</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><em>0x0020000000000002</em></p></td>
<td></td>
<td><p>SOO.outdoor is able to collect data from any weather station. This ME
can be used in conjunction with other MEs which can use this kind of data.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><em>0x0020000000000003</em></p></td>
<td></td>
<td><p>SOO.wagoled is able to received event from an EnOcean switch and redirect
the received commnand to the Wago ecosystem.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="system-and-housekeeping-mobile-entities">
<h4><span class="section-number">2.3.1.2.3. </span>System and housekeeping mobile entities<a class="headerlink" href="#system-and-housekeeping-mobile-entities" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SPID</p></th>
<th class="head"><p>ME Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>0x0030000000000001</em></p></td>
<td><p>SOO.agency enables the upgrade of agency image within a smart object. The ME
has an embedded of the new version of agency. All smart objects can be updated.</p></td>
</tr>
<tr class="row-odd"><td><p><em>0x0030000000000002</em></p></td>
<td><p>SOO.net can transport networking data packet from a SOO.net smart object to any
other smart objects. The ME can then collect data packet to forward them to the network.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="species-aptitude-descriptor-spad">
<h3><span class="section-number">2.3.1.3. </span>Species Aptitude Descriptor (SPAD)<a class="headerlink" href="#species-aptitude-descriptor-spad" title="Link to this heading">¶</a></h3>
<p>Each ME may have one or several <a class="reference internal" href="../../glossary.html#term-SPAD"><span class="xref std std-term">SPAD</span></a> (Species Aptitude Descriptor). The <code class="docutils literal notranslate"><span class="pre">SPAD</span></code> determines a specific
feature (or set of features).</p>
<p>The <em>SPAD</em> is also used to tell the agency if the ME is inclined to cooperate with other ME.</p>
<p>Enabling the possibility for an ME to perform <em>cooperation</em> with other ME requires to call
the following function in the main application of the ME:</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.spad_enable_cooperate">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">spad_enable_cooperate</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.spad_enable_cooperate" title="Link to this definition">¶</a><br /></dt>
<dd></dd></dl>

</section>
</section>
<section id="lifecycle-of-a-mobile-entity">
<h2><span class="section-number">2.3.2. </span>Lifecycle of a Mobile Entity<a class="headerlink" href="#lifecycle-of-a-mobile-entity" title="Link to this heading">¶</a></h2>
<p>The ME may frequently migrate from one smart object to another one. Actually, a memory snapshot
of the ME to migrate is performed by the agency, which is transfered to the other smart object.
Of course, the snapshot requires the ME to be in a consistent state; that is why the ME must
suspend its frontend drivers before the snapshot is done. All frontend drivers will be resumed
right after the copy; these operations happen with efficient inter-CPU interrupt (IPI) mechanisms and
are performed very quickly; In most cases, the running ME is briefly interrupted and does not cause
any significant latency.</p>
<p>Hence, when a ME is injected into a smart object by the user, or coming from another smart object,
the agency initiates a sequence of callbacks function execution within the context of the ME, but
from the CPU’s agency, i.e. CPU #0. The residing ME has its own callback sequence which involves
suspending (before the snapshot) and resuming (after the snapshot) the backend drivers.
The callback sequences are therefore slightly different between the residing ME and the migrated ME.</p>
<p>Furthermore, in the migrating (arriving) ME, the ME has to create and initialize the <code class="docutils literal notranslate"><span class="pre">vbstore</span></code> entries
related to itself as well as to all frontend drivers managed by the ME.</p>
<p>Finally, the newly injected ME (from a tablet/smartphone or automatically from the SD-card at the boot time)
has a dedicated callback sequence as well.</p>
<p>All these callback sequences are described in the next sections.</p>
<section id="state-of-a-mobile-entity">
<h3><span class="section-number">2.3.2.1. </span>State of a Mobile Entity<a class="headerlink" href="#state-of-a-mobile-entity" title="Link to this heading">¶</a></h3>
<p>Any ME has an internal state to manage its behaviour. The state can be changed at any time by the different callbacks.
The following functions are available to manage the ME state:</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.set_ME_state">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">set_ME_state</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">ME_state_t</span></span><span class="w"> </span><span class="n"><span class="pre">state</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.set_ME_state" title="Link to this definition">¶</a><br /></dt>
<dd><p>To set a ME in a specific state</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.get_ME_state">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">get_ME_state</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.get_ME_state" title="Link to this definition">¶</a><br /></dt>
<dd><p>To get the current a ME state.</p>
</dd></dl>

<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>State</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>ME_state_booting</em></p></td>
<td><p>ME is currently booting…</p></td>
</tr>
<tr class="row-odd"><td><p><em>ME_state_preparing</em></p></td>
<td><p>ME is being paused during the boot process, in the case of an injection, before the frontend initialization</p></td>
</tr>
<tr class="row-even"><td><p><em>ME_state_living</em></p></td>
<td><p>ME is full-functional and activated (all frontend devices are consistent)</p></td>
</tr>
<tr class="row-odd"><td><p><em>ME_state_suspended</em></p></td>
<td><p>ME is suspended before migrating. This state is maintained for the resident ME instance</p></td>
</tr>
<tr class="row-even"><td><p><em>ME_state_migrating</em></p></td>
<td><p>ME just arrived in SOO</p></td>
</tr>
<tr class="row-odd"><td><p><em>ME_state_dormant</em></p></td>
<td><p>ME is resident, but not living (running)</p></td>
</tr>
<tr class="row-even"><td><p><em>ME_state_killed</em></p></td>
<td><p>ME has been killed before to be resumed</p></td>
</tr>
<tr class="row-odd"><td><p><em>ME_state_terminated</em></p></td>
<td><p>ME has been terminated (by a force_terminate)</p></td>
</tr>
<tr class="row-even"><td><p><em>ME_state_dead</em></p></td>
<td><p>ME does not exist</p></td>
</tr>
</tbody>
</table>
</section>
<section id="callback-functions">
<h3><span class="section-number">2.3.2.2. </span>Callback functions<a class="headerlink" href="#callback-functions" title="Link to this heading">¶</a></h3>
<p>There are two kinds of callback functions in a ME: <code class="docutils literal notranslate"><span class="pre">domcalls</span></code> and <code class="docutils literal notranslate"><span class="pre">dc_event</span></code> based callbacks.
Domcalls are functions which are called by the agency directly, on its dedicated CPU (CPU #0),
in the context of the ME. Callbaks using <em>dc_event</em> are triggered from the CPU agency through an IPI
(Inter-Processor Interrupt) and the ME executes the code itself, enabling the possibility to use
its scheduler (it is not the case with <em>domcalls</em> of course).</p>
<section id="callback-functions-domcalls">
<h4><span class="section-number">2.3.2.2.1. </span>Callback functions - <em>domcalls</em><a class="headerlink" href="#callback-functions-domcalls" title="Link to this heading">¶</a></h4>
<p>A <em>domcall</em> function is typically called by the agency and executed on the agency CPU. There is
an switch of address space to reach the memory context of the ME and to be able to access its variables.
Consequently, asynchronous activities which could require access to the ME scheduler is <strong>strictly forbidden</strong>.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.cb_pre_propagate">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">cb_pre_propagate</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">soo_domcall_arg_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.cb_pre_propagate" title="Link to this definition">¶</a><br /></dt>
<dd><p>It is called right before the migration, i.e. the snapshot of the ME.
<code class="docutils literal notranslate"><span class="pre">args</span></code> is of type <code class="docutils literal notranslate"><span class="pre">pre_propagate_args_t</span></code> and has a <code class="docutils literal notranslate"><span class="pre">status</span></code> field which
can have the following value: <code class="docutils literal notranslate"><span class="pre">PROPAGATE_STATUS_YES</span></code> or <code class="docutils literal notranslate"><span class="pre">PROPAGATE_STATUS_NO</span></code>
indicating if the ME can be propagated or not.
If the ME is not propagated, no further callback functions are executed.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.cb_pre_activate">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">cb_pre_activate</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">soo_domcall_arg_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.cb_pre_activate" title="Link to this definition">¶</a><br /></dt>
<dd><p>Called after a migration to see if it makes sense for this ME to be resumed
in this smart object. If not, the ME state can be set to <code class="docutils literal notranslate"><span class="pre">ME_state_killed</span></code></p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.cb_cooperate">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">cb_cooperate</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">soo_domcall_arg_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.cb_cooperate" title="Link to this definition">¶</a><br /></dt>
<dd><p>This a very important callback function which allows the migrated ME to exchange
information with other MEs which reside in the smart object.
<code class="docutils literal notranslate"><span class="pre">args</span></code> is of type <cite>cooperate_args_t</cite> containing a field called <code class="docutils literal notranslate"><span class="pre">role</span></code></p>
<p>The role can be <code class="docutils literal notranslate"><span class="pre">COOPERATE_INITIATOR</span></code> or <code class="docutils literal notranslate"><span class="pre">COOPERATE_TARGET</span></code> depending in
which ME the <em>cooperate()</em> function is executed. The first role is given to
the migrated ME while the second role is given to the residing ME when the
migrated ME performed a call to the <em>cooperate()</em> function in this (residing) ME.
This mechanism clearly enables inter-ME collaboration and is useful to decide
which ME must stay alive or be killed.</p>
</dd></dl>

</section>
<section id="callback-functions-dc-event">
<h4><span class="section-number">2.3.2.2.2. </span>Callback functions - <em>dc_event</em><a class="headerlink" href="#callback-functions-dc-event" title="Link to this heading">¶</a></h4>
<p>The following callback functions are executed in the ME context on the CPU belonging to the ME.
Asynchronous activities requiring the ME scheduler are authorized.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.cb_pre_suspend">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">cb_pre_suspend</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">soo_domcall_arg_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.cb_pre_suspend" title="Link to this definition">¶</a><br /></dt>
<dd><p>Called before suspending the frontend drivers.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.cb_pre_resume">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">cb_pre_resume</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">soo_domcall_arg_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.cb_pre_resume" title="Link to this definition">¶</a><br /></dt>
<dd><p>Called before resuming the frontend drivers</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.cb_post_activate">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">cb_post_activate</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">soo_domcall_arg_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.cb_post_activate" title="Link to this definition">¶</a><br /></dt>
<dd><p>This callback function is called once all frontend drivers have been resumed. It is
the final callback function called at the end of each migration process.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.cb_force_terminate">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">cb_force_terminate</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.cb_force_terminate" title="Link to this definition">¶</a><br /></dt>
<dd><p>Tell the ME that a <em>force terminate</em> will be performed for this ME.
The ME state is changed during this callback and is typically
set to <code class="docutils literal notranslate"><span class="pre">ME_state_terminated</span></code></p>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <em>suspend</em> and <em>resume</em> callbacks are not specific to a particular ME and is a generic
procedure to suspend and to resume frontend drivers. The code of this callbacks should <strong>NOT</strong> be changed.</p>
</div>
</section>
</section>
<section id="callback-sequence-in-the-injected-me">
<h3><span class="section-number">2.3.2.3. </span>Callback sequence in the injected ME<a class="headerlink" href="#callback-sequence-in-the-injected-me" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">The following sequence is executed during a ME injection:</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">pre_activate</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">cooperate</span></code></div>
</div>
<p>The ME state is set to <code class="docutils literal notranslate"><span class="pre">ME_state_living</span></code></p>
</section>
<section id="callback-sequence-in-the-residing-me">
<h3><span class="section-number">2.3.2.4. </span>Callback sequence in the residing ME<a class="headerlink" href="#callback-sequence-in-the-residing-me" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">The following sequence is executed during a migration process:</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">pre_propagate</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">pre_suspend</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">suspend</span></code> (snapshot) <code class="docutils literal notranslate"><span class="pre">resume</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">post_activate</span></code></div>
</div>
<p>The ME state is set to <code class="docutils literal notranslate"><span class="pre">ME_state_living</span></code></p>
</section>
<section id="callback-sequence-in-the-migrating-me">
<h3><span class="section-number">2.3.2.5. </span>Callback sequence in the migrating ME<a class="headerlink" href="#callback-sequence-in-the-migrating-me" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">The following sequence is executed during a migration process:</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">pre_propagate</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">pre_suspend</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">suspend</span></code> (snapshot &amp; migrating) <code class="docutils literal notranslate"><span class="pre">pre_activate</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">cooperate</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">resume</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">post_activate</span></code></div>
</div>
<p>The ME state is set to <code class="docutils literal notranslate"><span class="pre">ME_state_living</span></code></p>
</section>
</section>
<section id="me-interactions-with-the-user-interface-application">
<h2><span class="section-number">2.3.3. </span>ME Interactions with the User Interface application<a class="headerlink" href="#me-interactions-with-the-user-interface-application" title="Link to this heading">¶</a></h2>
<p>The ME can manage XML messages and events in order to interact with a GUI running
on the tablet. The following helpers are very helpful to this purpose. The messages/events
are forwarded to the vuihandler frontend.</p>
<section id="message-handling">
<h3><span class="section-number">2.3.3.1. </span>Message handling<a class="headerlink" href="#message-handling" title="Link to this heading">¶</a></h3>
<p>This function prepare a XML message based on its ID and value:</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.xml_prepare_message">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xml_prepare_message</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buffer</span></span>, <span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">id</span></span>, <span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">value</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xml_prepare_message" title="Link to this definition">¶</a><br /></dt>
<dd><p>The buffer is allocated by the caller and will contain the XML formatted message.</p>
</dd></dl>

</section>
<section id="event-handling">
<h3><span class="section-number">2.3.3.2. </span>Event handling<a class="headerlink" href="#event-handling" title="Link to this heading">¶</a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.xml_parse_event">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">xml_parse_event</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buffer</span></span>, <span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">id</span></span>, <span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">action</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.xml_parse_event" title="Link to this definition">¶</a><br /></dt>
<dd><p>The event message (pointed by <em>buffer</em>) contains a specific action with an associated ID. These fields can be retrieved
with this function. The caller must allocate the memory.</p>
</dd></dl>

</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../agency/soolink/plugins.html" class="btn btn-neutral float-left" title="2.2.2.3. Plugins management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../virt_interfaces/virt_interfaces.html" class="btn btn-neutral float-right" title="2.4. Virtualized interfaces (backend/frontend)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, HEIG-VD - REDS Institute.
      <span class="lastupdated">Last updated on 08 Jul 2024, 16:43.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>